---
- name: Update all packages & autoremove old packages
  become: true
  ansible.builtin.apt:
    name: "*"
    autoremove: true
    state: latest
    update_cache: true
- name: Request reboot if required
  debug:
    msg: Reboot is needed
  notify: reboot
  when: "{{ '/var/run/reboot-required' is file }}"
- name: Install common packages
  become: true
  ansible.builtin.apt:
    state: present # Some of these are "duh" but I've had random packages missing on various distros so...
    name:
    - apt-transport-https
    - bash
    - ca-certificates
    - curl
    - git
    - less
    #- mtr-tiny # Don't enable on server, requires SUID binary
    - nano
    - sudo
    #- tmux
    - wget
- name: Remove unneeded packages
  become: true
  ansible.builtin.apt:
    state: absent
    name:
    - snapd # don't need on server
